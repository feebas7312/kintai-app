<%= render "shared/header" %>
<h2 class="planning-title">勤務計画作成</h2>
<%= render "shared/flash" %>

<%= form_with url: new_work_schedule_path, method: :get, local: true do |f| %>
  <div class='input-date-wrap'>
    <%= raw sprintf(
                f.date_select(
                  :search_date,
                  class:'select-date',
                  use_month_numbers: true,
                  discard_day: true,
                  prompt:'--',
                  date_separator: '%s'),
                "<p> 年 </p>") + "<p> 月 </p>" %>
    <%= f.submit "検索", class: "search-btn" %>
  </div>
<% end %>

<div class="create-btn">
  <%= link_to '計算', "###", class: "planning-btn" %>
  <%= link_to '保存', "###", class: "save-btn" %>
</div>

<div class="planning-content">
  <div class="member">
    <ul class="member-content">
      <li class="text4"><%= "#{@year}年#{@month}月度" %></li>
      <li class="text2"><%= @admin.last_name %></li>
      <% @employees.each do |employee| %>
        <li class="text2"><%= employee.last_name %></li>
      <% end %>
    </ul>
  </div>

  <%= form_with model: @work_schedule, url: work_schedules_path, method: :post, local: true do |f| %>
    <div class="shift">
      <% day=0 %>
      <% @work_schedules.collection.each do |work_schedule| %>
      <% day+=1 %>

        <ul class="shift-content">

          <%= fields_for 'work_schedules[]', work_schedule do |field| %>
            <li class="text4"><%= "#{day}日" %></li>
            <li class="text3">
              <%= field.hidden_field :work_date, value: Date.new(@year, @month, day) %>
              <%= field.text_field :work_start_time, prompt: '--', minute_step: 15, ignore_data: true, class: "field" %>〜
              <%= field.text_field :work_end_time, prompt: '--', minute_step: 15, ignore_data: true, class: "field" %>
              <%= field.hidden_field :admin_id, value: @admin.id %>
            </li>
          <% end %>
          <%= fields_for 'work_schedules[]', work_schedule do |field| %>
            <% @employees.each do |employee| %>
              <li class="text3">
                <%= field.hidden_field :work_date, value: Date.new(@year, @month, day) %>
                <%= field.text_field :work_start_time, prompt: '--', minute_step: 15, ignore_data: true, class: "field" %>〜
                <%= field.text_field :work_end_time, prompt: '--', minute_step: 15, ignore_data: true, class: "field" %>
                <%= field.hidden_field :employee_id, value: employee.id %>
              </li>
            <% end %>
          <% end %>
        </ul>

      <% if day == @days %>
        <% break %>
      <% end %>

      <% end %>
      <%= f.submit '保存', class: "search-btn" %>
    </div>
  <% end %>

</div>

<%= render "shared/footer" %>